package controllers

import java.io.{File, InputStream}

import play.api.Play
import play.api.Play.current
import play.api.libs.json.Json
import play.api.mvc.{Action, Controller}


/**
  * Created by valery.kuznetsov on 09-Dec-15.
  */
class Proguard extends Controller {

  val proguardFolder = "/public/proguards/"
  val proguardSuffix = "proguard-"
  val proguardExtension = ".pro"
  val proguardList = "list.txt"
  val title = "# Created by https://proguard.herokuapp.com/api/\n\n%s"

  def proguard(libraryName: String) = Action {
    val libraries = libraryName.split(',')
    val result = libraries
      .filter(listInDir(proguardFolder).contains)
      .map(el => Play.resourceAsStream(proguardFolder + proguardSuffix + el + proguardExtension))
      .filter(_.isDefined)
      .map(el => readFile(el.get)) mkString

    Ok(title.format(result))
  }

  def list() = Action {
    Ok(Json.toJson(listInDir(proguardFolder)))
  }

  private def listInDir(filePath: String): Array[String] = {
    readFile(Play.resourceAsStream(proguardFolder + proguardList).get)
      .split("\r\n")
      .map(_.replace(proguardExtension, "")
        .replace(proguardSuffix, ""))
  }

  def getListOfFiles(dir: File): List[File] = {
    dir.listFiles.toList
  }

  def readFile(stream: InputStream): String = {
    val source = scala.io.Source.fromInputStream(stream)
    val lines = try source.mkString finally source.close()
    lines
  }


  def autocomplete() = Action {
    Ok("[{\"id\":\"alteraquartusii\",\"text\":\"AlteraQuartusII\"},{\"id\":\"appbuilder\",\"text\":\"AppBuilder\"},{\"id\":\"appengine\",\"text\":\"AppEngine\"},{\"id\":\"assembler\",\"text\":\"Assembler\"},{\"id\":\"atmelstudio\",\"text\":\"AtmelStudio\"},{\"id\":\"appcode\",\"text\":\"AppCode\"},{\"id\":\"basic\",\"text\":\"Basic\"},{\"id\":\"bazel\",\"text\":\"Bazel\"},{\"id\":\"bitrix\",\"text\":\"Bitrix\"},{\"id\":\"bower\",\"text\":\"Bower\"},{\"id\":\"carthage\",\"text\":\"Carthage\"},{\"id\":\"ceylon\",\"text\":\"Ceylon\"},{\"id\":\"code\",\"text\":\"Code\"},{\"id\":\"codeblocks\",\"text\":\"CodeBlocks\"},{\"id\":\"codekit\",\"text\":\"CodeKit\"},{\"id\":\"codeio\",\"text\":\"Codeio\"},{\"id\":\"coffeescript\",\"text\":\"CoffeeScript\"},{\"id\":\"crashlytics\",\"text\":\"Crashlytics\"},{\"id\":\"crystal\",\"text\":\"Crystal\"},{\"id\":\"django\",\"text\":\"Django\"},{\"id\":\"dotsettings\",\"text\":\"DotSettings\"},{\"id\":\"dropbox\",\"text\":\"Dropbox\"},{\"id\":\"elasticbeanstalk\",\"text\":\"ElasticBeanstalk\"},{\"id\":\"elixir\",\"text\":\"Elixir\"},{\"id\":\"f#\",\"text\":\"F#\"},{\"id\":\"flashbuilder\",\"text\":\"FlashBuilder\"},{\"id\":\"flex\",\"text\":\"Flex\"},{\"id\":\"freepascal\",\"text\":\"FreePascal\"},{\"id\":\"genero4gl\",\"text\":\"Genero4GL\"},{\"id\":\"hsp\",\"text\":\"HSP\"},{\"id\":\"intellij\",\"text\":\"Intellij\"},{\"id\":\"jabref\",\"text\":\"JabRef\"},{\"id\":\"joe\",\"text\":\"Joe\"},{\"id\":\"kirby2\",\"text\":\"Kirby2\"},{\"id\":\"justcode\",\"text\":\"JustCode\"},{\"id\":\"komodoedit\",\"text\":\"KomodoEdit\"},{\"id\":\"latex\",\"text\":\"LaTeX\"},{\"id\":\"laravel\",\"text\":\"Laravel\"},{\"id\":\"less\",\"text\":\"Less\"},{\"id\":\"liberosoc\",\"text\":\"LiberoSOC\"},{\"id\":\"modx\",\"text\":\"MODX\"},{\"id\":\"meteorjs\",\"text\":\"MeteorJS\"},{\"id\":\"nette\",\"text\":\"Nette\"},{\"id\":\"octobercms\",\"text\":\"OctoberCms\"},{\"id\":\"openfoam\",\"text\":\"OpenFOAM\"},{\"id\":\"phoenix\",\"text\":\"Phoenix\"},{\"id\":\"phpstorm\",\"text\":\"PhpStorm\"},{\"id\":\"pimcore\",\"text\":\"Pimcore\"},{\"id\":\"pinegrow\",\"text\":\"PineGrow\"},{\"id\":\"polymer\",\"text\":\"Polymer\"},{\"id\":\"purescript\",\"text\":\"PureScript\"},{\"id\":\"pycharm\",\"text\":\"PyCharm\"},{\"id\":\"rubymine\",\"text\":\"RubyMine\"},{\"id\":\"sas\",\"text\":\"SAS\"},{\"id\":\"scheme\",\"text\":\"Scheme\"},{\"id\":\"senchatouch\",\"text\":\"SenchaTouch\"},{\"id\":\"shopware\",\"text\":\"Shopware\"},{\"id\":\"silverstripe\",\"text\":\"Silverstripe\"},{\"id\":\"smalltalk\",\"text\":\"Smalltalk\"},{\"id\":\"sonar\",\"text\":\"Sonar\"},{\"id\":\"splunk\",\"text\":\"Splunk\"},{\"id\":\"stata\",\"text\":\"Stata\"},{\"id\":\"stellar\",\"text\":\"Stellar\"},{\"id\":\"stylus\",\"text\":\"Stylus\"},{\"id\":\"tarmainstallmate\",\"text\":\"TarmaInstallMate\"},{\"id\":\"terraform\",\"text\":\"Terraform\"},{\"id\":\"tower\",\"text\":\"Tower\"},{\"id\":\"virtuoso\",\"text\":\"Virtuoso\"},{\"id\":\"wakanda\",\"text\":\"Wakanda\"},{\"id\":\"webstorm\",\"text\":\"WebStorm\"},{\"id\":\"wintersmith\",\"text\":\"Wintersmith\"},{\"id\":\"xamarinstudio\",\"text\":\"XamarinStudio\"},{\"id\":\"xcode\",\"text\":\"Xcode\"},{\"id\":\"yii2\",\"text\":\"Yii2\"},{\"id\":\"basercms\",\"text\":\"baserCMS\"},{\"id\":\"bluej\",\"text\":\"bluej\"},{\"id\":\"easybook\",\"text\":\"easybook\"},{\"id\":\"fastlane\",\"text\":\"fastlane\"},{\"id\":\"greenfoot\",\"text\":\"greenfoot\"},{\"id\":\"grunt\",\"text\":\"grunt\"},{\"id\":\"jspm\",\"text\":\"jspm\"},{\"id\":\"librarian-chef\",\"text\":\"librarian-chef\"},{\"id\":\"m2e\",\"text\":\"m2e\"},{\"id\":\"ph7cms\",\"text\":\"pH7CMS\"},{\"id\":\"premake-gmake\",\"text\":\"premake-gmake\"},{\"id\":\"puppet-librarian\",\"text\":\"puppet-librarian\"},{\"id\":\"actionscript\",\"text\":\"Actionscript\"},{\"id\":\"ada\",\"text\":\"Ada\"},{\"id\":\"agda\",\"text\":\"Agda\"},{\"id\":\"android\",\"text\":\"Android\"},{\"id\":\"appceleratortitanium\",\"text\":\"AppceleratorTitanium\"},{\"id\":\"archlinuxpackages\",\"text\":\"ArchLinuxPackages\"},{\"id\":\"autotools\",\"text\":\"Autotools\"},{\"id\":\"c++\",\"text\":\"C++\"},{\"id\":\"c\",\"text\":\"C\"},{\"id\":\"cfwheels\",\"text\":\"CFWheels\"},{\"id\":\"cmake\",\"text\":\"CMake\"},{\"id\":\"cuda\",\"text\":\"CUDA\"},{\"id\":\"cakephp\",\"text\":\"CakePHP\"},{\"id\":\"chefcookbook\",\"text\":\"ChefCookbook\"},{\"id\":\"clojure\",\"text\":\"Clojure\"},{\"id\":\"codeigniter\",\"text\":\"CodeIgniter\"},{\"id\":\"commonlisp\",\"text\":\"CommonLisp\"},{\"id\":\"composer\",\"text\":\"Composer\"},{\"id\":\"concrete5\",\"text\":\"Concrete5\"},{\"id\":\"coq\",\"text\":\"Coq\"},{\"id\":\"craftcms\",\"text\":\"CraftCMS\"},{\"id\":\"d\",\"text\":\"D\"},{\"id\":\"dm\",\"text\":\"DM\"},{\"id\":\"dart\",\"text\":\"Dart\"},{\"id\":\"delphi\",\"text\":\"Delphi\"},{\"id\":\"drupal\",\"text\":\"Drupal\"},{\"id\":\"episerver\",\"text\":\"EPiServer\"},{\"id\":\"eagle\",\"text\":\"Eagle\"},{\"id\":\"elisp\",\"text\":\"Elisp\"},{\"id\":\"elm\",\"text\":\"Elm\"},{\"id\":\"erlang\",\"text\":\"Erlang\"},{\"id\":\"expressionengine\",\"text\":\"ExpressionEngine\"},{\"id\":\"extjs\",\"text\":\"ExtJs\"},{\"id\":\"fancy\",\"text\":\"Fancy\"},{\"id\":\"forcedotcom\",\"text\":\"ForceDotCom\"},{\"id\":\"finale\",\"text\":\"Finale\"},{\"id\":\"fortran\",\"text\":\"Fortran\"},{\"id\":\"fuelphp\",\"text\":\"FuelPHP\"},{\"id\":\"gwt\",\"text\":\"GWT\"},{\"id\":\"gcov\",\"text\":\"Gcov\"},{\"id\":\"gitbook\",\"text\":\"GitBook\"},{\"id\":\"go\",\"text\":\"Go\"},{\"id\":\"gradle\",\"text\":\"Gradle\"},{\"id\":\"grails\",\"text\":\"Grails\"},{\"id\":\"haskell\",\"text\":\"Haskell\"},{\"id\":\"igorpro\",\"text\":\"IGORPro\"},{\"id\":\"idris\",\"text\":\"Idris\"},{\"id\":\"java\",\"text\":\"Java\"},{\"id\":\"jboss\",\"text\":\"Jboss\"},{\"id\":\"jekyll\",\"text\":\"Jekyll\"},{\"id\":\"joomla\",\"text\":\"Joomla\"},{\"id\":\"kicad\",\"text\":\"KiCAD\"},{\"id\":\"kohana\",\"text\":\"Kohana\"},{\"id\":\"labview\",\"text\":\"LabVIEW\"},{\"id\":\"leiningen\",\"text\":\"Leiningen\"},{\"id\":\"lemonstand\",\"text\":\"LemonStand\"},{\"id\":\"lilypond\",\"text\":\"Lilypond\"},{\"id\":\"lithium\",\"text\":\"Lithium\"},{\"id\":\"lua\",\"text\":\"Lua\"},{\"id\":\"magento\",\"text\":\"Magento\"},{\"id\":\"maven\",\"text\":\"Maven\"},{\"id\":\"mercury\",\"text\":\"Mercury\"},{\"id\":\"metaprogrammingsystem\",\"text\":\"MetaProgrammingSystem\"},{\"id\":\"nanoc\",\"text\":\"Nanoc\"},{\"id\":\"nim\",\"text\":\"Nim\"},{\"id\":\"ocaml\",\"text\":\"OCaml\"},{\"id\":\"opa\",\"text\":\"Opa\"},{\"id\":\"objective-c\",\"text\":\"Objective-C\"},{\"id\":\"node\",\"text\":\"Node\"},{\"id\":\"opencart\",\"text\":\"OpenCart\"},{\"id\":\"oracleforms\",\"text\":\"OracleForms\"},{\"id\":\"packer\",\"text\":\"Packer\"},{\"id\":\"perl\",\"text\":\"Perl\"},{\"id\":\"phalcon\",\"text\":\"Phalcon\"},{\"id\":\"plone\",\"text\":\"Plone\"},{\"id\":\"playframework\",\"text\":\"PlayFramework\"},{\"id\":\"prestashop\",\"text\":\"Prestashop\"},{\"id\":\"processing\",\"text\":\"Processing\"},{\"id\":\"python\",\"text\":\"Python\"},{\"id\":\"qooxdoo\",\"text\":\"Qooxdoo\"},{\"id\":\"qt\",\"text\":\"Qt\"},{\"id\":\"r\",\"text\":\"R\"},{\"id\":\"ros\",\"text\":\"ROS\"},{\"id\":\"rails\",\"text\":\"Rails\"},{\"id\":\"rhodesrhomobile\",\"text\":\"RhodesRhomobile\"},{\"id\":\"ruby\",\"text\":\"Ruby\"},{\"id\":\"rust\",\"text\":\"Rust\"},{\"id\":\"scons\",\"text\":\"SCons\"},{\"id\":\"sass\",\"text\":\"Sass\"},{\"id\":\"scala\",\"text\":\"Scala\"},{\"id\":\"scrivener\",\"text\":\"Scrivener\"},{\"id\":\"sdcc\",\"text\":\"Sdcc\"},{\"id\":\"seamgen\",\"text\":\"SeamGen\"},{\"id\":\"sketchup\",\"text\":\"SketchUp\"},{\"id\":\"stella\",\"text\":\"Stella\"},{\"id\":\"sugarcrm\",\"text\":\"SugarCRM\"},{\"id\":\"swift\",\"text\":\"Swift\"},{\"id\":\"symfony\",\"text\":\"Symfony\"},{\"id\":\"symphonycms\",\"text\":\"SymphonyCMS\"},{\"id\":\"tex\",\"text\":\"TeX\"},{\"id\":\"textpattern\",\"text\":\"Textpattern\"},{\"id\":\"turbogears2\",\"text\":\"TurboGears2\"},{\"id\":\"typo3\",\"text\":\"Typo3\"},{\"id\":\"umbraco\",\"text\":\"Umbraco\"},{\"id\":\"unity\",\"text\":\"Unity\"},{\"id\":\"unrealengine\",\"text\":\"UnrealEngine\"},{\"id\":\"vvvv\",\"text\":\"VVVV\"},{\"id\":\"visualstudio\",\"text\":\"VisualStudio\"},{\"id\":\"waf\",\"text\":\"Waf\"},{\"id\":\"wordpress\",\"text\":\"WordPress\"},{\"id\":\"xojo\",\"text\":\"Xojo\"},{\"id\":\"yeoman\",\"text\":\"Yeoman\"},{\"id\":\"zendframework\",\"text\":\"ZendFramework\"},{\"id\":\"yii\",\"text\":\"Yii\"},{\"id\":\"zephir\",\"text\":\"Zephir\"},{\"id\":\"anjuta\",\"text\":\"Anjuta\"},{\"id\":\"archives\",\"text\":\"Archives\"},{\"id\":\"bricxcc\",\"text\":\"BricxCC\"},{\"id\":\"cvs\",\"text\":\"CVS\"},{\"id\":\"cloud9\",\"text\":\"Cloud9\"},{\"id\":\"darteditor\",\"text\":\"DartEditor\"},{\"id\":\"dreamweaver\",\"text\":\"Dreamweaver\"},{\"id\":\"eclipse\",\"text\":\"Eclipse\"},{\"id\":\"eiffelstudio\",\"text\":\"EiffelStudio\"},{\"id\":\"emacs\",\"text\":\"Emacs\"},{\"id\":\"ensime\",\"text\":\"Ensime\"},{\"id\":\"flexbuilder\",\"text\":\"FlexBuilder\"},{\"id\":\"espresso\",\"text\":\"Espresso\"},{\"id\":\"gpg\",\"text\":\"GPG\"},{\"id\":\"ipythonnotebook\",\"text\":\"IPythonNotebook\"},{\"id\":\"jdeveloper\",\"text\":\"JDeveloper\"},{\"id\":\"jetbrains\",\"text\":\"JetBrains\"},{\"id\":\"kdevelop4\",\"text\":\"KDevelop4\"},{\"id\":\"kate\",\"text\":\"Kate\"},{\"id\":\"lazarus\",\"text\":\"Lazarus\"},{\"id\":\"libreoffice\",\"text\":\"LibreOffice\"},{\"id\":\"linux\",\"text\":\"Linux\"},{\"id\":\"lyx\",\"text\":\"LyX\"},{\"id\":\"matlab\",\"text\":\"Matlab\"},{\"id\":\"mercurial\",\"text\":\"Mercurial\"},{\"id\":\"microsoftoffice\",\"text\":\"MicrosoftOffice\"},{\"id\":\"modelsim\",\"text\":\"ModelSim\"},{\"id\":\"momentics\",\"text\":\"Momentics\"},{\"id\":\"monodevelop\",\"text\":\"MonoDevelop\"},{\"id\":\"netbeans\",\"text\":\"NetBeans\"},{\"id\":\"ninja\",\"text\":\"Ninja\"},{\"id\":\"notepadpp\",\"text\":\"NotepadPP\"},{\"id\":\"osx\",\"text\":\"OSX\"},{\"id\":\"otto\",\"text\":\"Otto\"},{\"id\":\"redcar\",\"text\":\"Redcar\"},{\"id\":\"redis\",\"text\":\"Redis\"},{\"id\":\"sbt\",\"text\":\"SBT\"},{\"id\":\"svn\",\"text\":\"SVN\"},{\"id\":\"slickedit\",\"text\":\"SlickEdit\"},{\"id\":\"sublimetext\",\"text\":\"SublimeText\"},{\"id\":\"tags\",\"text\":\"Tags\"},{\"id\":\"synopsysvcs\",\"text\":\"SynopsysVCS\"},{\"id\":\"textmate\",\"text\":\"TextMate\"},{\"id\":\"tortoisegit\",\"text\":\"TortoiseGit\"},{\"id\":\"vagrant\",\"text\":\"Vagrant\"},{\"id\":\"vim\",\"text\":\"Vim\"},{\"id\":\"virtualenv\",\"text\":\"VirtualEnv\"},{\"id\":\"visualstudiocode\",\"text\":\"VisualStudioCode\"},{\"id\":\"webmethods\",\"text\":\"WebMethods\"},{\"id\":\"windows\",\"text\":\"Windows\"},{\"id\":\"xilinxise\",\"text\":\"XilinxISE\"}]").as(JSON)
  }
}
